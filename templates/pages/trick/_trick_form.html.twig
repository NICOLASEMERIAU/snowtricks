<div class="container" >
    {{ form_start(form) }}
    <div class="form-group">
        {{ form_label(form.name) }}
        {{ form_widget(form.name) }}
        <div class="form-error">
            {{ form_errors(form.name) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.description) }}
        {{ form_widget(form.description) }}
        <div class="form-error">
            {{ form_errors(form.description) }}
        </div>
    </div>
    <div class="form-group">
        {{ form_label(form.trickgroup) }}
        {{ form_widget(form.trickgroup) }}
        <div class="form-error">
            {{ form_errors(form.trickgroup) }}
        </div>
    </div>
{#    <div class="form-group">#}
{#        {{ form_label(form.mainimageFile) }}#}
{#        {{ form_widget(form.mainimageFile) }}#}
{#        <div class="form-error">#}
{#            {{ form_errors(form.mainimageFile) }}#}
{#        </div>#}
{#    </div>#}
    <div class="form-group">
        <div class="row">
            <div class="col-sm-9">
                {{ form_row(form.mainimageFile, {
                    attr: {
                        'placeholder': 'Select an article image'
                    }
                }) }}
            </div>
            <div class="col-sm-3">
                {% if form.vars.data.mainimage|default %}

                    <img src="{{ asset('images/tricks/'~form.vars.data.mainimage)|imagine_filter('squared_thumbnail_small') }}" height="100">
                {% endif %}
            </div>
        </div>
    </div>
    <div class="form-group">
        <h3>Images</h3>
        <button type="button" class="add_item_link" data-collection-holder-class="images">Ajoute une image</button>
        <ul class="images"
            data-index="{{ form.images|length > 0 ? form.images|last.vars.name + 1 : 0 }}"
            data-prototype="{{ form_widget(form.images.vars.prototype)|e('html_attr') }}"
        >
            {% for image in form.images %}
                <li>{{ form_row(image.name) }}</li>
            {% endfor %}
        </ul>
    </div>

    <div class="form-group">
        {{ form_row(form.Editer) }}
    </div>
    {{ form_end(form) }}
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        console.log('test');
        document
            .querySelectorAll('.add_item_link')
            .forEach(btn => {
                btn.addEventListener("click", (e) => {
                    const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

                    const item = document.createElement('li');

                    item.innerHTML = collectionHolder
                        .dataset
                        .prototype
                        .replace(
                            /__name__/g,
                            collectionHolder.dataset.index
                        );

                    collectionHolder.appendChild(item);

                    collectionHolder.dataset.index++;
                })
            });
    })

    document
        .querySelectorAll('.add_item_link')
        .forEach(btn => {
            btn.addEventListener("click", addFormToCollection)
        });

    const addFormToCollection = (e) => {
        const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

        const item = document.createElement('li');

        item.innerHTML = collectionHolder
            .dataset
            .prototype
            .replace(
                /__name__/g,
                collectionHolder.dataset.index
            );

        collectionHolder.appendChild(item);

        collectionHolder.dataset.index++;
    };
</script>
